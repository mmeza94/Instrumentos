@using MyResource = Laboratorio.Messages;   


@model  Laboratorio.Models.ToolKitModel


@{
    ViewBag.Title = "Index";
    bool odd = true;


}
@if (Request.IsAuthenticated)
{
    <fieldset>
        <legend>Creación de plantillas</legend>






        <fieldset>
            @using (Html.BeginForm("InsertNewToolKitCatalog", "Toolkit", FormMethod.Post))
            {
                <div class="editor-label">
                    @Html.Label("Nombre Plantilla")
                </div>
                <div class="textBox textBoxEnable">
                    @Html.TextBox("KitCode")
                </div>
                <div class="editor-label">
                    @Html.Label("Operación")
                </div>
                @Html.DropDownList("MachineCode", ViewBag.Sli as List<SelectListItem>)
                <p>
                    <input class="csbutton" type="submit" value="Crear" />
                </p>

            }

        </fieldset>
           
       
       



        @*Primera Tabla -- Contiene los instrumentos de cada plantilla seleccionada*@


        @using (Html.BeginForm("Index", "Toolkit", FormMethod.Post))
        {
            <fieldset>
                <legend>Plantilla-Herramientas</legend>

                <div class="ui-corner-left">
                    <br />
                    <label for="MachineCode">
                        Operación
                    </label>
                    @Html.DropDownList("MachineCode", ViewBag.Sli as List<SelectListItem>, new { onchange = "this.form.submit()" })


                    <br />
                    <br />
                    <label for="ToolKitCode">
                        Plantilla
                    </label>
                    @Html.DropDownList("ToolKitCode", ViewBag.toolkitCodes as List<SelectListItem>, new { onchange = "this.form.submit()" })

                    <br />

                    <a href="@Url.Action("DeleteToolkit", "Toolkit")">
                        <input class="csbutton" type="button" value="Borrar" />
                    </a>

                </div>
                <table class="center">
                    <tr class="TableHeader">
                        <th>
                            C&oacute;digo
                        </th>
                        <th>
                            Tipo
                        </th>
                        <th>
                            Fecha de calibraci&oacute;n
                        </th>
                        <th>
                            Fecha de expiraci&oacute;n
                        </th>
                        <th>
                            Estado
                        </th>

                        <th>
                            Uso
                        </th>
                        <th>
                        </th>
                        <th>

                        </th>
                        @*<th>
                                Checkbox
                            </th>*@

                        @if (ViewBag.MachineCode == "EMBAL1" || ViewBag.MachineCode == "EMBAL2")
                        {
                            if (ViewBag.MachineCode == "EMBAL1")
                            {
                                <th>Compartir con Pintado Tina B</th>
                            }
                            else
                            {
                                <th>Compartir con Pintado Tina A</th>
                            }
                        }
                    </tr>

                    @*Aqui comienza contenido de primera tabla*@
                    @if (ViewBag.NoRecords)
                    {
                        <tr class="noRecords">
                            <td colspan="5" class="gridRowOdd">
                                @MyResource.NoRecords
                            </td>
                        </tr>
                    }
                    else
                    {
                        foreach (var tm in ViewBag.ToolKit)
                        {
                            <tr class="@(odd ? "gridRowOdd" : "gridRowEven")">
                                <td>
                                    @tm.Code
                                </td>
                                <td>
                                    @tm.Type
                                </td>
                                <td class="centeredTD">
                                    @tm.CalibrationDate.ToString("dd/MM/yy")
                                </td>
                                <td class="centeredTD">
                                    @tm.ExpirationDate.ToString("dd/MM/yy")
                                </td>

                                @switch ((string)tm.ExpirationFlag)
                                {
                                    case "0":
                                        <td class="centeredTD Danger">
                                            Vencido
                                        </td>
                                        break;
                                    case "1":
                                        <td class="centeredTD Warning">
                                            Próximo a vencer
                                        </td>
                                        break;
                                    case "2":
                                        <td class="centeredTD ">
                                            En Tiempo
                                        </td>
                                        break;

                                }

                                @if (tm.Measure)
                                {
                                    <td class="centeredTD">
                                        Medici&oacute;n
                                    </td>
                                }
                                else
                                {
                                    <td class="centeredTD">
                                        Control
                                    </td>

                                }
                                <td>
                                    <a href="@Url.Action("RemoveTool", "Toolkit", new { toolCode = tm.Code, measure = tm.Measure})">
                                        <img alt="@MyResource.DownArrowImageAlt" src="@Url.Content("~/Content/images/downarrow.png")" />
                                    </a>
                                </td>
                                <td>

                                    <a href="@Url.Action("UpdateToolPage", "Tool", new { code = tm.Code })">
                                        <img alt="@MyResource.UpdateImageAlt" src="@Url.Content("~/Content/images/change.png")" />
                                    </a>

                                </td>




                            </tr>

                            odd = odd ? false : true;
                        }
                    }
                </table>
                @if (ViewBag.ValidationMessage != null)
                {
                    <label class="validationError">@ViewBag.ValidationMessage</label>
                }
            </fieldset>
            <br />
        }




        @*Segunda tabla -- contiene todas los instrumentos disponibles*@



        @using (Html.BeginForm("ToolMassiveAction", "Toolkit", FormMethod.Post))
                {
                    <fieldset>
                        <legend>Instrumentos disponibles</legend>



                        <div class="editor-label">
                            @Html.Label("Agregar a plantilla:")
                        </div>




                        @*radiobutton*@
                        <div>
                            <label>Control</label>
                            <input id="Control" name="Control" value="0" type="radio" onclick="SetMeasure(0)" />

                            <label>Medicion</label>
                            <input id="Medicion" name="Control" value="1" type="radio" onclick="SetMeasure(1)" />
                        </div>







                        <input type="hidden" id="MeasureUse" name="MeasureUse" />



                        <table>
                            <tr class="TableHeader">
                                <th>
                                    Plantilla
                                </th>
                                <th>

                                </th>
                            </tr>



                            @{
                                int CodeCount = 0;
                            }


                            @foreach (var item in Model.ToolKitCodes)
                            {

                                <tr class="@(odd ? "gridRowOdd" : "gridRowEven")">
                                    <td>
                                        @Html.TextBox("CodeToolkit" + CodeCount, item)
                                        @* @item.Value*@
                                    </td>
                                    <td>
                                        <input type="checkbox" id="@String.Format("checkedCode{0}", CodeCount)" onclick="checarActivosCodeToolkit()" />
                                    </td>



                                </tr>
                                odd = odd ? false : true;
                                CodeCount++;


                            }

                            <input type="hidden" id="hdncountCodeToolkit" value="@CodeCount" />

                            <input type="hidden" id="activosCodeToolkit" name="activosCodeToolkit" />

                        </table>


                        @*Botones Submit del formulario*@

                        <input class="csbutton" name="Action" type="submit" value="Insertar" />
                        <input class="csbutton" name="Action" type="submit" value="Borrar" />





                        <table class="center">
                            <tr class="TableHeader">
                                <th>
                                    C&oacute;digo
                                </th>
                                <th>
                                    Tipo
                                </th>
                                <th>
                                    Fecha de calibraci&oacute;n
                                </th>
                                <th>
                                    Fecha de expiraci&oacute;n
                                </th>
                                <th>
                                    Estado
                                </th>
                                <th>
                                    Medición
                                </th>
                                <th>
                                    Control
                                </th>
                                <th>

                                </th>
                                <th>
                                    C
                                </th>
                            </tr>



                            @if (ViewBag.NoRecords2)
                            {
                                <tr class="noRecords">
                                    <td colspan="5" class="gridRowOdd">
                                        @MyResource.NoRecords
                                    </td>
                                </tr>
                            }
                            else
                            {





                                int cont = 0;
                                foreach (Laboratorio.Models.ToolModel tool in Model.Tools)
                                {
                                    <tr class="@(odd ? "gridRowOdd" : "gridRowEven")">
                                        <td >
                                            

                                                @Html.TextBox("Code" + cont, tool.Code)
                                            
                                        </td>
                                        <td>
                                            @tool.Type
                                        </td>
                                        <td class="centeredTD">
                                            @tool.CalibrationDate.ToString("dd/MM/yy")
                                        </td>
                                        <td class="centeredTD">
                                            @tool.ExpirationDate.ToString("dd/MM/yy")
                                        </td>
                                        @switch ((string)tool.ExpirationFlag)
                                        {
                                            case "0":
                                                <td class="centeredTD Danger">
                                                    Vencido
                                                </td>
                                                break;
                                            case "1":
                                                <td class="centeredTD Warning">
                                                    Próximo a vencer
                                                </td>
                                                break;
                                            case "2":
                                                <td class="centeredTD ">
                                                    En Tiempo
                                                </td>
                                                break;

                                        }
                                        <td class="centeredTD">
                                            <a href="@Url.Action("AddTool", "Toolkit", new { toolCode = tool.Code,  use = 1 })">
                                                <img alt="@MyResource.UpArrowMeasureImageAlt" src="@Url.Content("~/Content/images/uparrow.png")" />
                                            </a>
                                        </td>
                                        <td class="centeredTD">
                                            <a href="@Url.Action("AddTool", "Toolkit", new { toolCode = tool.Code,  use = 0 })">
                                                <img alt="@MyResource.UpArrowControlImageAlt" src="@Url.Content("~/Content/images/uparrow.png")" />
                                            </a>
                                        </td>
                                        <td>

                                            <a href="@Url.Action("UpdateToolPage", "Tool", new { code = tool.Code })">
                                                <img alt="@MyResource.UpdateImageAlt" src="@Url.Content("~/Content/images/change.png")" />
                                            </a>

                                        </td>
                                        <td>
                                            <input type="checkbox" id="@String.Format("checked{0}", cont)" onclick="checarActivos()" />
                                            @*@Html.CheckBox("isChecked"+cont, tool.isChecked,  )*@
                                        </td>

                                    </tr>
                                    odd = odd ? false : true;
                                    cont++;
                                }



                                <input type="hidden" id="hdncount" value="@cont" />

                                <input type="hidden" id="activos" name="activos" />










                            }
                        </table>

                    </fieldset>



                }
                
        <script>
            function checarActivos() {
                let codesActive = "";
                let cont = parseInt($('input#hdncount').val()) - 1;
                let result = $('input#activos');

                for (let x = 0; x <= cont; x++) {
                    let ischecked = $('#checked'+x).is(":checked")
                    let codeChecked = $('input#Code' + x).val();

                    if (ischecked) {
                        codesActive += codeChecked + ',';
                    }
                }

                console.log(codesActive)
                result.val(codesActive);
            }


            function checarActivosCodeToolkit() {
                let codesActive = "";
                let cont = parseInt($('input#hdncountCodeToolkit').val()) - 1;
                let result = $('input#activosCodeToolkit');

                for (let x = 0; x <= cont; x++) {
                    let ischecked = $('#checkedCode' + x).is(":checked")
                    let codeChecked = $('input#CodeToolkit' + x).val();

                    if (ischecked) {
                        codesActive += codeChecked + ',';
                    }
                }

                console.log(codesActive)
                result.val(codesActive);
            }

            function SetMeasure(numero) {
                let result = $('input#MeasureUse'); 
                
                console.log(numero);
                result.val(numero);
            }


        </script>
        
    </fieldset>
}
else
{
    @Html.Partial("_LogInFormPartial")
}





